---
title: "Proportion tests: one proportion, two propotions, multiple proportions test"
author: "Illarion  Jabine"
date: "02/04/2022"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = FALSE,
	message = FALSE,
	warning = FALSE
)
```


# 1. Required packages:


* ggstatsplot: 
creates graphics with details from statistical tests included in the plots themselves. 
It provides an easier syntax to generate information-rich plots for statistical analysis of continuous (violin plots, scatterplots, histograms, dot plots, dot-and-whisker plots) or categorical (pie and bar charts) data. 
Currently, it supports the most common types of statistical approaches and tests: parametric, nonparametric, robust, and Bayesian versions of t-test/ANOVA, correlation analyses, contingency table analysis, meta-analysis, and regression analyses.

```{r load libraries, message=FALSE, warning=FALSE}
library(ggstatsplot)
library(tidyverse)
```


# 2. Key terms and links
http://www.sthda.com/english/wiki/comparing-proportions-in-r
https://indrajeetpatil.github.io/ggstatsplot/reference/ggbarstats.html


# 3. Types of the test of proportions
We have to destinguish several types of proportion tests.

## 3.1 Compare one sample with a target

### 3.1.1 One proportion test (binary population proportion)

Source (https://support.minitab.com/en-us/minitab/20/help-and-how-to/statistics/basic-statistics/how-to/1-proportion/before-you-start/overview/)

Use 1 Proportion to estimate a binomial population proportion and to compare the proportion to a target value or a reference value. Using this analysis, you can do the following when your data contain only two categories, such as pass/fail:
   1. Determine whether the population proportion differs from the hypothesized proportion that you specify.
   2. Calculate a range of values that is likely to include the population proportion.
For example, a marketing analyst wants to determine whether mailed advertisements that were sent to a random sample of households result in a response rate that is different from the national average of 6.5% (target value). If the proportion differs from the target value, the analyst can use the confidence interval to determine whether the difference is practically significant.
 % Defective vs. target
 Each item is classified into one of two categories, such as pass/fail or defective/nondefective. You count the number of defective items and compare the percentage of defectives with a target percentage. 

It's important to know that each item in the sample should have the same chance of being defective. 
(source minitab)
To produce accurate results, each item in the sample should have the same chance of being defective as any other item in the sample. Therefore, the items in the sample should be collected under the same inputs and conditions, such as personnel, equipment, suppliers, or environment. 
For example, different machines that apply paint coatings may produce a different percentage of defective coatings. Therefore, you wouldn't want to collect samples from the different machines and treat them as if they were from a single machine. You should also avoid collecting samples over long periods of time, which can increase the likelihood of process changes that can alter the defective rate. 

Statistical test to use in R: prop.test() and/or binom.test()
URL: http://www.sthda.com/english/wiki/one-proportion-z-test-in-r
https://stats.libretexts.org/Bookshelves/Introductory_Statistics/Book%3A_Statistics_Using_Technology_(Kozak)/07%3A_One-Sample_Inference/7.02%3A_One-Sample_Proportion_Test


Example:
Engineers examine a sample of bolts for severe cracks that make the bolts unusable. They record the number of bolts that are inspected and the number of bolts that are rejected. The engineers want to determine whether the percentage of defective bolts is less than 0.2%.

Example 2:
According to the February 2008 Federal Trade Commission report on consumer fraud and identity theft, 23% of all complaints in 2007 were for identity theft. In that year, Arkansas had 1,601 complaints of identity theft out of 3,482 consumer complaints ("Consumer fraud and," 2008). Does this data provide enough evidence to show that Arkansas had a higher proportion of identity theft than 23%? Test at the 5% level.

Solution:
1. Parameters
x = number of complaints of identity theft in Arkansas = 1601 
p = proportion of identity theft in population = 0.23
n = a simple random sample of size n  = 3482

2. Hypothesis
Null hypothesis (H0): There is no significant difference between the observed and the expected value.
Alternative hypothesis (Ha): There is a significant difference between the observed and the expected value.
Ho:p=0.23 
HA:p>0.23
α=0.05

R code:
```{r}
prop_res <- prop.test(x = 1601, n = 3482, p = 0.23,alternative = "greater",correct = TRUE)
prop_res

# using binom test:
binom.test(x = 1601, n = 3482, p = 0.23,alternative = "greater")
```
3. Conclusion:
Calculated p value is less than 0.05 => we reject H0. There is enough evidence to show that the proportion of Arkansas has a higher proportion of identity theft than 23%.



### 3.1.2 One sample proportion test (three or more outcome categories)

Percents in each outcome category vs. target
chi-square goodness of fit test is used to compare the observed distribution to an expected distribution, in a situation where we have three or more categories in a discrete data. In other words, it compares multiple observed proportions to expected probabilities.

Source (minitab)
Each item is classified into one of three or more outcome categories, such as poor, fair, good, and excellent. You count the number of items in each category and compare the percentage in each category with its target percentage. 

Statistical hypotheses
Null hypothesis (H0): There is no significant difference between the observed and the expected value.
Alternative hypothesis (Ha): There is a significant difference between the observed and the expected value

Example:
Analysts at a finance department sample overdue invoices and categorize them by the number of days that payment is overdue: 15 days or less, 16–30 days, or 31 days or more. They want to determine whether the percentage of overdue invoices in each category differs from its target percentage.

Let's say he collected a sample of 100 invoices.
For example, the target (expected) proportion might be the following: 
15 days: 50%
16-30 days: 40%
31 days and more: 10%

The observed proportion:
15 days: 40%
16-30 days: 40%
31 days and more: 20%

The research question is: We want to know,if there is any significant difference between the observed proportions and the expected proportions.

Statistical test to use in R: chisq.test() - Chi-Square Goodness-of-fit test
URL: http://www.sthda.com/english/wiki/chi-square-goodness-of-fit-test-in-r
     https://www.r-bloggers.com/2015/01/goodness-of-fit-test-in-r/
    https://indrajeetpatil.github.io/ggstatsplot/articles/web_only/ggpiestats.html#goodness-of-fit-with-ggpiestats

```{r}
invoices <- c(40,40,20)
x_squared_test <- chisq.test(x = invoices, p = c(0.5,0.4,0.1))
x_squared_test
```
Conclusion:
The p-value of the test is less than the significance level alpha = 0.05 => we reject H0. We can conclude that the significant difference between the observed and the expected value



## 3.2 Two proportion tests (compare two samples with each other)

### 3.2.1 Two proportion test (binary proportion)

Source (minitab)
Two % defectives 
Each item is classified into one of two categories, such as pass/fail or defective/nondefective. You count the number of defective items in each sample and compare the percentage of defectives between the two samples. 

Example:
Quality engineers at a delivery company count the number of mishandled packages in a sample of deliveries from the old process and in a sample of deliveries from the new process. They want to determine whether the percentage of mishandled packages differs for the two processes. 

URL: http://www.sthda.com/english/wiki/two-proportions-z-test-in-r

Statistical test to use in R: prop.test()

Example using R (example from "STATISTICS FOR BUSINESS AND ECONOMICS" by Anderson):
A tax preparation firm is interested in comparing the quality of work at two of its regional
offices. By randomly selecting samples of tax returns prepared at each office and verifying
the sample returns’ accuracy, the firm will be able to estimate the proportion of
erroneous returns prepared at each office. Of particular interest is the difference between
these proportions.
Independent simple random samples from the two offices provide the following information:
Office 1
n1 = 250
Number of returns with errors = 35

Office 2
n2 = 300
Number of returns with errors = 27

Research question is:
Whether the observed proportion of returns with errors in Office 1 (p1) is equal to the observed proportion of returns with errors in Office 2 (p2)?
It's two.sided alternative hypothesis.

```{r}
# x = c(35,27): a vector of counts of successes, i.e. returns with errors
# n = c(250, 300): a vector of counts of trials

prop.test(x = c(35,27), n = c(250, 300),conf.level = 0.9,correct = FALSE,alternative = "two.sided")


```
Conclusion: 
With the p-value less than α = .10,
H0 is rejected at the .10 level of significance. The firm can conclude that the error rates differ between the two offices.
As an additional check, 0 is not included into the interval estimate of the difference between the population error rates: 0.004815898 0.095184102

### 3.2.2 Two sample proportion test (three or more outcome categories)

Source (minitab)
Percents in each outcome category
Each item is classified into one of three or more outcome categories, such as poor, fair, good, and excellent. You count the number of items in each category and compare the percentage in each category between the two samples. 

Example:
Analysts at a finance department sample overdue invoices and categorize them by the number of days that payment is overdue: 15 days or less, 16–30 days, or 31 days or more. They want to determine whether the percentage of overdue invoices in each category differs before and after they increase late fees. 

URL: http://www.sthda.com/english/wiki/chi-square-test-of-independence-in-r
https://en.wikipedia.org/wiki/Pearson%27s_chi-squared_test
https://libguides.library.kent.edu/SPSS/ChiSquare

Statistical test to use in R: chisq.test() - Chi-Square Test of Independence (aka Chi-Square Test for Association)



## 3.3 Three or more population proportion tests (compare more than two samples)

### 3.3.1 Three or more proportion tests (compare three or more samples with each other, binary proportion)

For this type of proportion tests Chi-Square Test is used.

Source (minitab)
More than two % defectives
The chi-square % defective test determines whether the percentage of defective items is significantly different among more than two samples. 
Each item is classified into one of two categories, such as pass/fail or defective/nondefective. You count the number of defective items in each sample and compare the percentage of defectives between the samples. 
This test is used to determine whether the % defective for three or more processes or process conditions differs. To collect data, you could take samples from the same process under three or more conditions. For example, you could test several different speed settings on a machine to determine whether the speed setting affects the % defective. Or, you could collect samples from three or more different processes, such as three machines, that produce the same output. To obtain data that are representative of the processes or process conditions, randomly select the items for each sample. 
Example:
Engineers examine samples of bolts from four machines for severe cracks that make the bolts unusable. For each sample, the engineers record the number of bolts that are accepted and the number of bolts that are rejected. They want to determine whether the % defective differs for each machine.

Another example from "STATISTICS FOR BUSINESS AND ECONOMICS" by Anderson:
The chi-square test statistic can be used to make statistical inferences about the equality of population proportions for three or more populations.
If the sample data and the chi-square test computations indicate H0 cannot be rejected, we cannot detect a difference among the k population proportions. 
However, if the sample data and the chi-square test computations indicate H0 can be rejected, we have the statistical
evidence to conclude that not all k population proportions are equal; that is, one or more population proportions differ from the other population proportions.
An organization would like to use the proportion of owners likely to repurchase a particular automobile as an indication of customer loyalty for the automobile.
An automobile with a greater proportion of owners likely to repurchase is concluded to have greater customer loyalty. Suppose that in a particular study we want to compare the customer loyalty for three automobiles: Chevrolet Impala, Ford Fusion, and Honda Accord.
The current owners of each of the three automobiles form the three populations for the study. 
The three population proportions of interest are as follows:
 p1: proportion likely to repurchase an Impala for the population of Chevrolet Impala owners
 p2: proportion likely to repurchase a Fusion for the population of Ford Fusion owners
 p3: proportion likely to repurchase an Accord for the population of Honda Accord owners
The hypotheses are stated as follows:
 H0: p1 = p2 = p3
 Ha: Not all population proportions are equal
URL: http://www.sthda.com/english/wiki/chi-square-test-of-independence-in-r

Statistical test to use in R: chisq.test() - Chi-Square Test of Independence (aka Chi-Square Test for Association)

### 3.3.2 Three or more proportion tests (three or more outcome categories)

Source (minitab)

The chi-square test for association determines whether the percentage of items in each outcome category is significantly different for two or more samples. 

Percents in each outcome category
Each item is classified into one of three or more outcome categories, such as poor, fair, good, and excellent. You count the number of items in each category and compare the percentage in each category between the samples. 

Example:
Analysts at a finance department sample overdue invoices and categorize them by the number of days that payment is overdue: 15 days or less, 16–30 days, or 31 days or more. They want to determine whether the percentage of overdue invoices in each category differs among four different sales regions.



